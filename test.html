<!DOCTYPE html>
<html>
  <head>
    <title>WFS</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@main/dist/en/v7.0.0/legacy/ol.css"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
    />
    <style>
      html,
      body {
        height: 100%;
        padding: 0;
        margin: 0;
        background-color: white;
      }
      .map {
        height: 100%;
        width: 100%;
      }
    </style>
    <!-- The line below is only needed for old environments like Internet Explorer and Android 4.x -->
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
    <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@main/dist/en/v7.0.0/legacy/ol.js"></script>
  </head>
  <body>
    <div id="map" class="map"><div id="popup"></div></div>
    <script>
      var vectorSource = new ol.source.Vector({
        format: new ol.format.GeoJSON(),
        url: function (extent) {
          return (
            "https://ahocevar.com/geoserver/wfs?service=WFS&" +
            "version=1.1.0&request=GetFeature&typename=osm:water_areas&" +
            "outputFormat=application/json&srsname=EPSG:3857&" +
            "bbox=" +
            extent.join(",") +
            ",EPSG:3857"
          );
        },
        strategy: ol.loadingstrategy.bbox,
      });

      var styleFunction = function (feature, resolution) {
        var zoom = map.getView().getZoomForResolution(resolution);
        var color = zoom > 13 ? "rgba(255, 0, 0, 1.0)" : "rgba(0, 0, 255, 1.0)";
        var style = new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: color,
            width: 2,
          }),
        });
        return style;
      };

      var vector = new ol.layer.Vector({
        source: vectorSource,
        style: styleFunction,
      });

      vector.getSource().on("featuresloadstart", function (evt) {
        console.log("start");
      });
      vector.getSource().on("featuresloadend", function (evt) {
        console.log("end");
      });

      var raster = new ol.layer.Tile({
        source: new ol.source.OSM(),
      });

      var view = new ol.View({
        center: [-8908887.277395891, 5381918.072437216],
        maxZoom: 19,
        zoom: 12,
      });

      var map = new ol.Map({
        layers: [raster, vector],
        target: document.getElementById("map"),
        view: view,
      });
    </script>
  </body>
</html>
